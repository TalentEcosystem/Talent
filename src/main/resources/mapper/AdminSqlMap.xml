<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.great.talent.mapper.AdminMapper">

    <select id="findKnow" resultType="Know" parameterType="java.util.Map">
		select * from tbl_knowledge a left join tbl_domain b on a.domainid=b.domainid
		<where>
			<if test="knowname!=null">
				a.knowname like concat('%',#{knowname},'%')
			</if>
			<if test="domainid!=null and domainid!=0">
				and a.domainid=#{domainid}
			</if>
			and a.knowstate='正常'
		</where>
		limit #{begin},#{end}
	</select>

	<select id="findCountKnow" resultType="int" parameterType="java.util.Map">
		select count(*) from tbl_knowledge a left join tbl_domain b on a.domainid=b.domainid
		<where>
			<if test="knowname!=null">
				a.knowname like concat('%',#{knowname},'%')
			</if>
			<if test="domainid!=null and domainid!=0">
				and a.domainid=#{domainid}
			</if>
			and a.knowstate='正常'
		</where>
	</select>

	<update id="updateKnow" parameterType="Know">
		update tbl_knowledge set knowname=#{knowname},knowintro=#{knowintro},domainid=#{domainid} where knowledgeid=#{knowledgeid}
	</update>

	<insert id="addKnow" parameterType="Know">
		insert into tbl_knowledge (knowname,knowintro,domainid,knowstate) values (#{knowname},#{knowintro},#{domainid},'正常')
	</insert>

	<delete id="deleteKnow" parameterType="java.lang.String">
		update tbl_knowledge set knowstate='已删除' where knowledgeid=#{knowledgeid}
	</delete>

    <select id="findUser" resultType="User" parameterType="java.util.Map">
        select * from tbl_user a left join tbl_school b on a.sid=b.sid
        <where>
            <if test="schoolname!=null">
                b.schoolname like concat('%',#{schoolname},'%')
            </if>
            <if test="ustate!=null and ustate!='全部'">
                and a.ustate=#{ustate}
            </if>
        </where>
        order by a.udate desc limit #{begin},#{end}
    </select>

    <select id="findCountUser" resultType="int" parameterType="java.util.Map">
        select count(*) from tbl_user a left join tbl_school b on a.sid=b.sid
        <where>
            <if test="schoolname!=null">
                b.schoolname like concat('%',#{schoolname},'%')
            </if>
            <if test="ustate!=null and ustate!='全部'">
                and a.ustate=#{ustate}
            </if>
        </where>
    </select>

    <update id="userForbid" parameterType="java.lang.String">
		update tbl_user set ustate='禁用' where uid=#{uid}
	</update>

    <update id="userEnable" parameterType="java.lang.String">
		update tbl_user set ustate='启用' where uid=#{uid}
	</update>



	<select id="findAllIndustry" resultType="Industry">
		select * from tbl_industry
	</select>

	<select id="findPost" resultType="Post" parameterType="java.util.Map">
		select * from tbl_post a left join tbl_industry b on a.industryid=b.industryid
		<where>
			<if test="industryid!=null and industryid!=0">
				a.industryid = #{industryid}
			</if>
			and a.poststate='正常'
		</where>
		limit #{begin},#{end}
	</select>

	<select id="findCountPost" resultType="int" parameterType="java.util.Map">
		select count(*) from tbl_post a left join tbl_industry b on a.industryid=b.industryid
		<where>
			<if test="industryid!=null and industryid!=0">
				a.industryid = #{industryid}
			</if>
			and a.poststate='正常'
		</where>
	</select>

	<insert id="addPost" parameterType="Post">
		insert into tbl_post (postname,industryid,poststate) values (#{postname},#{industryid},'正常')
	</insert>

	<update id="updatePost" parameterType="Post">
		update tbl_post set postname=#{postname},industryid=#{industryid} where postid=#{postid}
	</update>

	<update id="deletePost" parameterType="java.lang.String">
		update tbl_post set poststate='已删除' where postid=#{postid}
	</update>


	<select id="findCompany" parameterType="java.util.Map" resultType="Admin">
		select * from tbl_admin a left join tbl_company b on a.cid=b.cid
		<where>
			<if test="companyname!=null">
				b.companyname like concat('%',#{companyname},'%')
			</if>
			<if test="state!=null and state!='全部'">
				and a.state = #{state}
			</if>
			and a.roleid=2
		</where>
		order by a.date desc limit #{begin},#{end}
	</select>

	<select id="findCountCompany" parameterType="java.util.Map" resultType="int">
		select count(*) from tbl_admin a left join tbl_company b on a.cid=b.cid
		<where>
			<if test="companyname!=null">
				b.companyname like concat('%',#{companyname},'%')
			</if>
			<if test="state!=null and state!='全部'">
				and a.state = #{state}
			</if>
			and a.roleid=2
		</where>
	</select>

	<update id="checkConfirm" parameterType="java.lang.String">
		update tbl_admin set state='启用' where aid=#{aid}
	</update>

	<update id="checkRefuse" parameterType="java.lang.String">
		update tbl_admin set state='禁用' where aid=#{aid}
	</update>

	<select id="selectAllMenu" resultType="RoleMenu">
		select * from tbl_menu
	</select>

	<select id="selectRoleMenu" resultType="RoleMenu" parameterType="java.lang.String">
		select * from tbl_rolemenu a left join tbl_menu b on a.menuid=b.menuid where a.roleid=#{roleid}
	</select>

	<select id="selectParentMenu" resultType="RoleMenu" parameterType="java.util.List">
		select * from tbl_menu where menuid in
		<foreach item="item" index="" collection="list" open="(" separator="," close=")">
		#{item.parentid}
		</foreach>
	</select>

	<select id="selectChileMenu" resultType="java.lang.String" parameterType="java.lang.String">
		select a.menuid from tbl_rolemenu a left join tbl_menu b on b.menuid=a.menuid where a.roleid=#{roleid} and b.parentid!=0
	</select>

	<select id="selectNewMenu" resultType="java.lang.String" parameterType="java.util.List">
		select parentid from tbl_menu where menuid in
		<foreach item="item" index="" collection="list" open="(" separator="," close=")">
			#{item}
		</foreach>
		group by parentid
	</select>

	<delete id="deleteMenu" parameterType="java.lang.String">
		delete from tbl_rolemenu where roleid=#{roleid}
	</delete>

	<insert id="addMenu" parameterType="java.util.List">
		insert into tbl_rolemenu (roleid,menuid) values
		<foreach collection="list" index="index" separator="," item="item">
			(#{item.roleid},#{item.menuid})
		</foreach>
	</insert>

	<delete id="deleteFirst" parameterType="java.lang.String">
		delete from tbl_rolemenu where roleid=#{roleid} and menuid=#{menuid}
	</delete>


	<select id="findPara" resultType="Parameter" parameterType="java.util.Map">
		select * from tbl_para a
		<where>
			<if test="paraname!=null">
				a.paraname like concat('%',#{paraname},'%')
			</if>
			<if test="paratype!=null and paratype!='全部'">
				and a.paratype = #{paratype}
			</if>
			and a.parastate='启用'
		</where>
		limit #{begin},#{end}
	</select>

	<select id="findCountPara" parameterType="java.util.Map" resultType="int">
		select count(*) from tbl_para a
		<where>
			<if test="paraname!=null">
				a.paraname like concat('%',#{paraname},'%')
			</if>
			<if test="paratype!=null and paratype!='全部'">
				and a.paratype = #{paratype}
			</if>
			and a.parastate='启用'
		</where>
	</select>

	<update id="updatePara" parameterType="Parameter">
		update tbl_para set paraname=#{paraname},paratype=#{paratype},paravalue=#{paravalue} where paraid=#{paraid}
	</update>

	<update id="deletePara" parameterType="java.lang.String">
		update tbl_para set parastate='禁用' where paraid=#{paraid}
	</update>

	<insert id="addPara" parameterType="Parameter">
		insert into tbl_para (paraname, paravalue, paratype, parastate) values (#{paraname},#{paravalue},#{paratype},'启用')
	</insert>


	<insert id="addLog" parameterType="SystemLog">
        insert into tbl_log (logtype, logname, logresult, logdate) values (#{logtype},#{logname},#{logresult},#{logdate})
    </insert>

	<select id="findLog" parameterType="java.util.Map" resultType="SystemLog">
		select * from tbl_log
		<where>
			<if test="beginTime!=null and beginTime!=''">
				logdate &gt;= #{beginTime}
			</if>
			<if test="endTime!=null and endTime!=''">
				and logdate &lt;= #{endTime}
			</if>
		</where>
		limit #{begin},#{end}
	</select>

	<select id="findCountLog" parameterType="java.util.Map" resultType="int">
		select count(*) from tbl_log
		<where>
			<if test="beginTime!=null and beginTime!=''">
				logdate &gt;= #{beginTime}
			</if>
			<if test="endTime!=null and endTime!=''">
				and logdate &lt;= #{endTime}
			</if>
		</where>
	</select>

	<!--查询面试信息-->
	<select id="findInterview" resultType="Interview" parameterType="java.util.Map">
		select * from (select * from tbl_interview) a,
		(select u.uid,u.uname,u.utel,p.professid,p.professname,s.schoolname from tbl_user u,tbl_resume r,tbl_profession p,tbl_school s where
		u.uid = r.uid = s.sid and r.professid = p.professid) b,
		(select p.aid,p.positionid,p.positionname,id.industryid,id.indname from tbl_position p,tbl_industry id where p.industryid = id.industryid) c
		<where>
			a.uid = b.uid and a.positionid = c.positionid and a.interstate != '删除'
			<if test="industryid != null">
				and c.industryid = #{industryid}
			</if>
			<if test="positionname != null">
				and c.positionname = #{positionname}
			</if>
		</where>
		limit #{pageInts},#{limitInt}
	</select>
	<!--查询面试信息数量-->
	<select id="findInterviewNum" resultType="java.lang.Integer" parameterType="java.util.Map">
		select count(*) from (select * from tbl_interview) a,
		(select u.uid,u.uname,u.utel,p.professid,p.professname,s.schoolname from tbl_user u,tbl_resume r,tbl_profession p,tbl_school s where
		u.uid = r.uid = s.sid and r.professid = p.professid) b,
		(select p.aid, p.positionid,p.positionname,id.industryid,id.indname from tbl_position p,tbl_industry id where p.industryid = id.industryid) c
		<where>
			a.uid = b.uid and a.positionid = c.positionid and a.interstate != '删除'
			<if test="industryid != null">
				and c.industryid = #{industryid}
			</if>
			<if test="positionname != null">
				and c.positionname = #{positionname}
			</if>
		</where>
	</select>

	<insert id="addAdmin" parameterType="Admin">
		insert into tbl_admin (account, password, roleid, name, tel, state, address, date, money)
		values (#{account},#{password},#{roleid},#{name},#{tel},'启用',#{address},#{date},'0')
	</insert>

	<insert id="addSchool" parameterType="SchoolMsg" useGeneratedKeys="true" keyProperty="sid" keyColumn="sid">
		insert into tbl_school (schoolname) values (#{schoolname})
	</insert>

	<insert id="addSchoolAccount" parameterType="Admin">
		insert into tbl_admin (account, password, roleid, name, tel, state, address, date, money,cid)
		values (#{account},#{password},#{roleid},#{name},#{tel},'启用',#{address},#{date},'0',#{cid})
	</insert>


	<select id="findAllKnow" resultType="Know">
		select * from tbl_knowledge;
	</select>

	<select id="findChapter" parameterType="java.util.Map" resultType="Chapter">
		select * from tbl_chapter a left join tbl_knowledge b on a.knowledgeid=b.knowledgeid
		<where>
			<if test="chname!=null">
				a.chname like concat('%',#{chname},'%')
			</if>
			<if test="knowledgeid!=null and knowledgeid!=0">
				and a.knowledgeid = #{knowledgeid}
			</if>
			and a.chapstate='启用'
		</where>
		limit #{begin},#{end}
	</select>

	<select id="findCountChapter" parameterType="java.util.Map" resultType="int">
		select count(*) from tbl_chapter a left join tbl_knowledge b on a.knowledgeid=b.knowledgeid
		<where>
			<if test="chname!=null">
				a.chname like concat('%',#{chname},'%')
			</if>
			<if test="knowledgeid!=null and knowledgeid!=0">
				and a.knowledgeid = #{knowledgeid}
			</if>
			and a.chapstate='启用'
		</where>
	</select>

	<insert id="addChapter" parameterType="Chapter">
		insert into tbl_chapter (chname, chcount, chintro, chapurl, chaptime, knowledgeid, chapstate)
		values (#{chname},0,#{chintro},#{chapurl},#{chaptime},#{knowledgeid},'启用')
	</insert>

	<update id="deleteChapter" parameterType="java.lang.String">
		update tbl_chapter set chapstate='禁用' where chapterid=#{chapterid}
	</update>

	<update id="updateChapter" parameterType="Chapter">
		update tbl_chapter set knowledgeid=#{knowledgeid},chname=#{chname},chintro=#{chintro},
		 chaptime=#{chaptime},chapurl=#{chapurl} where chapterid=#{chapterid}
	</update>
</mapper>