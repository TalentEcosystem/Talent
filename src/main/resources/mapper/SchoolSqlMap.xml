<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.great.talent.mapper.SchoolMapper">

    <select id="findTalent" resultType="UserTalent">
        select u.uid,u.uaccount,r.rename,c.chname,p.professname,r.reemploy from tbl_user u,tbl_resume r,tbl_chapter c,tbl_profession p,tbl_school s
         <where>
             u.uid=r.uid  and r.professid=p.professid and r.sid=s.sid and u.chapterid=c.chapterid
            <if test="mindate!=null and mindate !=''">
                and u.udate &gt;=#{mindate}
            </if>
            <if test="maxdate!=null and maxdate !=''">
                and u.udate &lt;=#{maxdate}
            </if>
            <if test="schoolname!=null and schoolname !=''">
                and s.schoolname LIKE '%' #{schoolname} '%'
            </if>
            <if test="pro!=null and pro !=''">
                and p.professname LIKE '%' #{pro} '%'
            </if>
            and u.uid limit #{pageInt},#{limitInt}
        </where>
    </select>
    <select id="findTalentCount" resultType="int">
        select count(*) from (select u.uid,u.uaccount,r.rename,c.chname,p.professname,r.reemploy from tbl_user u,tbl_resume r,tbl_chapter c,tbl_profession p,tbl_school s
        <where>
            u.uid=r.uid and r.professid=p.professid and r.sid=s.sid and u.chapterid=c.chapterid
             <if test="mindate!=null and mindate !=''">
                 and u.udate &gt;=#{mindate}
             </if>
             <if test="maxdate!=null and maxdate !=''">
                 and u.udate &lt;=#{maxdate}
             </if>
             <if test="schoolname!=null and schoolname !=''">
                 and s.schoolname LIKE '%' #{schoolname} '%'
             </if>
             <if test="pro!=null and pro !=''">
                 and p.professname LIKE '%' #{pro} '%'
             </if>
         </where>
        )t
    </select>
    <select id="findUserResume" parameterType="UserTalent" resultType="Resume">
       SELECT a.rename,a.rebirth,b.degreename,c.professname,a.retel,d.schoolname,a.repic,a.readdress,a.repol,a.reskill,a.reeva from tbl_resume a,tbl_degree b,tbl_profession c,tbl_school d
    <where>
        a.degreeid=b.degreeid and a.professid=c.professid and d.sid=a.sid and a.uid=#{uid};
    </where>
    </select>
    <select id="findUserSocial" parameterType="UserTalent" resultType="Social">
        SELECT socialtime,company,content from tbl_social
        <where>
            uid=#{uid};
        </where>
    </select>
    <select id="findUserAducation" parameterType="UserTalent" resultType="Aducational">
        SELECT adtime,schoolname,profession from tbl_aducational
        <where>
            uid=#{uid}
        </where>
    </select>
    <select id="findSchoolInfo" resultType="SchoolMsg" parameterType="int">
        select schoolname,schoolinfo,schoolpic from tbl_school
        <where>
            sid=#{sid}
        </where>
    </select>
    <update id="updateSchool" parameterType="SchoolMsg">
        update tbl_school
        <set>
            schoolname=#{schoolname},
            schoolinfo=#{schoolinfo},
            <if test="schoolpic !=null and schoolpic !=''">
            schoolpic=#{schoolpic}
            </if>
        </set>
        <where>
            sid=#{sid}
        </where>
    </update>
    <select id="findRcommend" resultType="Recommend" parameterType="Recommend">
     select c.cid,b.positionid,d.indname,c.companyname,b.positionname,b.positiontime from tbl_admin a,tbl_position b,tbl_company c,tbl_industry d
    <where>
        a.cid=c.cid and b.industryid=d.industryid and  b.positionstate='发布' and b.aid=a.aid
        <if test="positionname !=null and positionname !=''">
           and b.positionname like '%' #{positionname} '%'
        </if>
        <if test="indname !=null and indname !=''">
           and  d.indname like '%' #{indname} '%'
        </if>
        and b.positionid limit #{pageInt},#{limitInt}
    </where>
    </select>
    <select id="findRcommendCount" resultType="int" parameterType="Recommend">
        select count(*) from tbl_admin a,tbl_position b,tbl_company c,tbl_industry d
        <where>
            a.cid=c.cid and b.industryid=d.industryid and b.positionstate='发布' and b.aid=a.aid
            <if test="positionname !=null and positionname !=''">
               and b.positionname like '%' #{positionname} '%'
            </if>
            <if test="indname !=null and indname !=''">
               and d.indname like '%' #{indname} '%'
            </if>
        </where>
    </select>
    <select id="findTalent1" resultType="UserTalent">
        select u.uid,u.uaccount,r.rename,s.schoolname,c.chname,p.professname,r.reemploy from tbl_user u,tbl_resume r,tbl_chapter c,tbl_profession p,tbl_school s
        <where>
            u.uid=r.uid and r.professid=p.professid and r.sid=s.sid and r.reemploy='否' and u.chapterid=c.chapterid
            <if test="mindate!=null and mindate !=''">
                and u.udate &gt;=#{mindate}
            </if>
            <if test="maxdate!=null and maxdate !=''">
                and u.udate &lt;=#{maxdate}
            </if>
            <if test="schoolname!=null and schoolname !=''">
                and s.schoolname LIKE '%' #{schoolname} '%'
            </if>
            <if test="pro!=null and pro !=''">
                and p.professname LIKE '%' #{pro} '%'
            </if>
            and s.sid=#{sid} and u.uid limit #{pageInt},#{limitInt}
        </where>
    </select>
    <select id="findTalentCount1" resultType="int">
        select count(*) from (select u.uid,u.uaccount,s.schoolname,r.rename,c.chname,p.professname,r.reemploy from tbl_user u,tbl_resume r,tbl_chapter c,tbl_profession p,tbl_school s
        <where>
            u.uid=r.uid and r.professid=p.professid and r.sid=s.sid and r.reemploy='否' and s.sid=#{sid} and u.chapterid=c.chapterid
            <if test="mindate!=null and mindate !=''">
                and u.udate &gt;=#{mindate}
            </if>
            <if test="maxdate!=null and maxdate !=''">
                and u.udate &lt;=#{maxdate}
            </if>
            <if test="schoolname!=null and schoolname !=''">
                and s.schoolname LIKE '%' #{schoolname} '%'
            </if>
            <if test="pro!=null and pro !=''">
                and p.professname LIKE '%' #{pro} '%'
            </if>
        </where>
        )t
    </select>
    <insert id="insertRecommend" parameterType="Recomend">
        insert into tbl_recommend(
            uid,
            recommendtime,
            positionid,
            cid
        )values (
            #{uid},
            #{recommendtime},
            #{positionid},
            #{cid}
        )

    </insert>
</mapper>