<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.great.talent.mapper.EnterpriseMapper">
<!-- 登录的sql   -->
    <select id="adminLogin" resultMap="userMap" parameterType="java.lang.String">
		select * from tbl_admin where ACCOUNT = #{account}
	</select>
    <resultMap id="userMap" type="Admin">
        <association property="role" javaType="role" select="selectRole"
                     column="roleid"></association>
    </resultMap>
<!--查询账号角色-->
    <select id="selectRole" parameterType="java.lang.Integer" resultType="Role">
		select * from tbl_role where roleid = #{roleid}
	</select>

    <insert id="addAdmin" parameterType="Admin">
    insert into tbl_admin (aid, account, password,
      roleid, name, tel,
      state, address, cid,
      sid, date,
      money)
    values (#{aid}, #{account}, #{password},
      #{roleid}, #{name}, #{tel},
      #{state}, #{address}, #{cid},
      #{sid}, #{date},
      #{money})
  </insert>

    <insert id="addCompany" parameterType="java.util.Map">
        insert into tbl_company(companyname,permit)values (#{companyname},#{permit})
    </insert>

    <select id="findPosition" resultType="Position" parameterType="java.util.Map">
        select p.*,a.name,i.*,d.*,pro.* from tbl_position p,tbl_admin a,tbl_industry i,tbl_degree d, tbl_profession pro
        <where>
        p.aid = a.aid and p.industryid = i.industryid and p.degreeid = d.degreeid and p.professid = pro.professid
            <if test="industryid != null">
                and p.industryid = #{industryid}
            </if>
            <if test="positionname != null">
                and p.positionname = #{positionname}
            </if>
            <if test="degreeid != null">
                and p.degreeid = #{degreeid}
            </if>
            <if test="professid != null">
                and p.professid = #{professid}
            </if>
            and p.positionstate = '发布'
        </where>
        order by positiontime desc
        limit #{pageInts},#{limitInt}
    </select>

    <select id="findPositionNum" resultType="java.lang.Integer" parameterType="java.util.Map">
        select count(*) from tbl_position p,tbl_admin a,tbl_industry i,tbl_degree d, tbl_profession pro
        <where>
            p.aid = a.aid and p.industryid = i.industryid and p.degreeid = d.degreeid and p.professid = pro.professid
            <if test="industryid != null">
                and p.industryid = #{industryid}
            </if>
            <if test="positionname != null">
                and p.positionname = #{positionname}
            </if>
            <if test="degreeid != null">
                and p.degreeid = #{degreeid}
            </if>
            <if test="professid != null">
                and p.professid = #{professid}
            </if>
            and p.positionstate = '发布'
        </where>
    </select>

    <insert id="addPositionInfo" parameterType="Position" useGeneratedKeys="true" keyProperty="positionid" keyColumn="positionid">
    insert into tbl_position (aid, positionname,
      maxnum, positionexper, request,
      money, positionaddress, positioncontent,
      positionstate, industryid, positiontime,
      degreeid, professid)
    values (#{aid}, #{positionname},
      #{maxnum}, #{positionexper}, #{request},
      #{money}, #{positionaddress}, #{positioncontent},
      #{positionstate}, #{industryid}, #{positiontime},
      #{degreeid}, #{professid})
  </insert>

    <insert id="addWelfare" parameterType="java.util.Map" >
        insert into tbl_welfare(welname,positionid)values (#{welname},#{positionid})
    </insert>
    <delete id="deleteWelfare" parameterType="java.util.Map" >
          delete from tbl_welfare where positionid = #{positionid}
      </delete>
    <update id="updatePositionInfo" parameterType="Position">
    update tbl_position
    set aid = #{aid},
      positionname = #{positionname},
      maxnum = #{maxnum},
      positionexper = #{positionexper},
      request = #{request},
      money = #{money},
      positionaddress = #{positionaddress},
      positioncontent = #{positioncontent},
      positionstate = #{positionstate},
      industryid = #{industryid},
      positiontime = #{positiontime},
      degreeid = #{degreeid},
      professid = #{professid}
    where positionid = #{positionid}
  </update>
      <update id="updatePositionState" parameterType="java.lang.Integer" >
          update tbl_position set positionstate = '删除' where positionid = #{positionid}
      </update>

</mapper>
